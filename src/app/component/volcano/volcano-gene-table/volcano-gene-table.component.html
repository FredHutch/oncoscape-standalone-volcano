<mat-expansion-panel *ngIf="selectedPoints.length > 0" [hideToggle]="false" [expanded]="true" style="margin-bottom: 10px;">
  <mat-expansion-panel-header>
      <mat-panel-title style="text-transform: none;">Selected Genes <span id="num-genes-selected">&nbsp;({{ selectedPoints.length }} Genes)</span></mat-panel-title>
  </mat-expansion-panel-header>
  <form
  [formGroup]="filterForm"
  style="font-size: 12px"
  id="filter-form"

>
  <mat-form-field appearance="outline">
    <mat-label>Search Selected Genes</mat-label>
    <input
      type="text"
      aria-label="Search Selected Genes"
      matInput
      formControlName="geneName"
      (keyup)="applyFilter()"
      placeholder="Enter gene name from table"
    />
  </mat-form-field>

  <mat-button-toggle-group formControlName="regulation" aria-label="Regulation">
    <mat-button-toggle value="all" (click)="applyFilter()"
      >All</mat-button-toggle
    >
    <mat-button-toggle value="downregulated" (click)="applyFilter()">
      <span>
        <mat-icon
          style="color: #c90a0a; font-size: small"
          matTooltip="downregulated"
          >arrow_downward</mat-icon
        >
      </span>
      Downregulated</mat-button-toggle
    >
    <mat-button-toggle value="upregulated" (click)="applyFilter()">
      <span>
        <mat-icon
          style="color: #0ac924; font-size: small"
          matTooltip="upregulated"
          >arrow_upward</mat-icon
        >
      </span>

      Upregulated</mat-button-toggle
    >
  </mat-button-toggle-group>

  <button
    mat-icon-button
    matTooltip="Copy gene list to clipboard"
    aria-label="Copy gene list to clipboard"
    (click)="copyToClipboard()"
  >
    <mat-icon>file_copy</mat-icon>
  </button>
</form>
</mat-expansion-panel>


<!-- Import MatTableDataSource and MatSort from @angular/material -->
<mat-table
  [dataSource]="dataSource"
  *ngIf="selectedPoints.length > 0"
  matSort
  id="selected-genes"
>
  <ng-container matColumnDef="select">
    <th mat-header-cell *matHeaderCellDef>
      Show label
      <br />
      <mat-checkbox
        #masterToggle
        (change)="$event ? toggleAllRows() : null"
        [checked]="selection.hasValue() && isAllSelected()"
        [indeterminate]="selection.hasValue() && !isAllSelected()"
      >
      </mat-checkbox>
      <!-- Show label -->
    </th>
    <td mat-cell *matCellDef="let row">
      <mat-checkbox
        (click)="$event.stopPropagation()"
        (change)="$event ? selection.toggle(row) : null"
        [checked]="selection.isSelected(row)"
      >
        <!-- This is to adjust for the "Show label" label on the checkbox column header -->
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <!-- &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -->
      </mat-checkbox>
    </td>
  </ng-container>

  <!-- Define the columns for the MatTable -->
  <ng-container matColumnDef="rank">
    <mat-header-cell *matHeaderCellDef mat-sort-header>Rank</mat-header-cell>
    <mat-cell *matCellDef="let point">{{
      dataSource.data.indexOf(point) + 1
    }}</mat-cell>
  </ng-container>

  <!-- Define the columns for the MatTable -->
  <ng-container matColumnDef="x">
    <mat-header-cell *matHeaderCellDef mat-sort-header>LogFC</mat-header-cell>
    <mat-cell *matCellDef="let point">
      <span *ngIf="point.x > 0">
        <mat-icon
          style="color: #0ac924; font-size: small; padding-top: 50%"
          matTooltip="upregulated"
          >arrow_upward</mat-icon
        >
      </span>
      <span *ngIf="point.x < 0">
        <mat-icon
          style="color: #c90a0a; font-size: small; padding-top: 50%"
          matTooltip="downregulated"
          >arrow_downward</mat-icon
        >
      </span>

      {{ point.x | number : "1.5" }}
    </mat-cell>
  </ng-container>

  <ng-container matColumnDef="y">
    <mat-header-cell *matHeaderCellDef mat-sort-header>-log<sub>10</sub>(p-adjusted)</mat-header-cell>
    <mat-cell *matCellDef="let point">{{
      point.y | scientific : "5"
    }}</mat-cell>
  </ng-container>

  <ng-container matColumnDef="gene">
    <mat-header-cell *matHeaderCellDef mat-sort-header>Gene</mat-header-cell>
    <mat-cell *matCellDef="let point">{{ point.gene }}</mat-cell>
  </ng-container>

  <!-- Set up MatTable's header row and columns -->
  <mat-header-row
    *matHeaderRowDef="displayedColumns; sticky: true"
  ></mat-header-row>
  <mat-row *matRowDef="let row; columns: displayedColumns"></mat-row>
</mat-table>
